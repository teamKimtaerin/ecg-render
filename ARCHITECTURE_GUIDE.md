# ECG GPU Render Server - ì•„í‚¤í…ì²˜ ê°€ì´ë“œ

## ğŸ¯ ì‹œìŠ¤í…œ ê°œìš”

ECG GPU Render ServerëŠ” MotionText ê¸°ë°˜ ìë§‰ì„ ë¹„ë””ì˜¤ì— ì˜¤ë²„ë ˆì´í•˜ëŠ” GPU ê°€ì† ë Œë”ë§ ì‹œìŠ¤í…œì…ë‹ˆë‹¤. ì „ì²´ ECG ë¹„ë””ì˜¤ ì²˜ë¦¬ íŒŒì´í”„ë¼ì¸ì˜ ë§ˆì§€ë§‰ ë‹¨ê³„ë¡œ, ML Audio Serverì—ì„œ ë¶„ì„ëœ ìë§‰ ë°ì´í„°ë¥¼ ë°›ì•„ ìµœì¢… ë Œë”ë§ëœ ë¹„ë””ì˜¤ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.

### í•µì‹¬ ëª©í‘œ
- **GPU ê°€ì†**: NVENC í•˜ë“œì›¨ì–´ ì¸ì½”ë”©ìœ¼ë¡œ 20-40ë°° ë¹ ë¥¸ ë Œë”ë§
- **ë¶„ì‚° ì²˜ë¦¬**: Celery + Redisë¡œ í™•ì¥ ê°€ëŠ¥í•œ ì›Œì»¤ í´ëŸ¬ìŠ¤í„°
- **ë©”ëª¨ë¦¬ ìµœì í™”**: Phase 2 ìŠ¤íŠ¸ë¦¬ë° íŒŒì´í”„ë¼ì¸ìœ¼ë¡œ 70% ë©”ëª¨ë¦¬ ì ˆì•½
- **ê³ ê°€ìš©ì„±**: ìë™ ì¬ì‹œë„, ì¥ì•  ë³µêµ¬, í—¬ìŠ¤ì²´í¬

## ğŸ—ï¸ ì „ì²´ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ECG Video Processing System                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   Frontend      â”‚    â”‚   Backend API   â”‚    â”‚ ML Audio     â”‚ â”‚
â”‚  â”‚   (React)       â”‚    â”‚   (Django)      â”‚    â”‚ Server       â”‚ â”‚
â”‚  â”‚   Port: 3000    â”‚â—„â”€â”€â–ºâ”‚   Port: 8000    â”‚â—„â”€â”€â–ºâ”‚ Port: 8080   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                  â”‚                               â”‚
â”‚                                  â–¼                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚              GPU Render Server (ì´ í”„ë¡œì íŠ¸)                â”‚ â”‚
â”‚  â”‚                    Port: 8090                                â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚                                                             â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚  FastAPI    â”‚  â”‚    Redis    â”‚  â”‚   Celery Workers    â”‚ â”‚ â”‚
â”‚  â”‚  â”‚   Server    â”‚  â”‚   Queue     â”‚  â”‚   (GPU Render)      â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚                                                             â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚              Streaming Pipeline (Phase 2)               â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  Playwright â†’ AsyncFrameQueue â†’ FFmpeg â†’ NVENC         â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                  â”‚                               â”‚
â”‚                                  â–¼                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                        AWS S3                               â”‚ â”‚
â”‚  â”‚              Rendered Video Storage                         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ§© í•µì‹¬ ì»´í¬ë„ŒíŠ¸ ë¶„ì„

### 1. API ì„œë²„ ê³„ì¸µ

#### `render_server.py` - FastAPI ë©”ì¸ ì„œë²„
```python
# ì£¼ìš” ì—”ë“œí¬ì¸íŠ¸
POST /render              # ë Œë”ë§ ì‘ì—… ìˆ˜ì‹  (ë©”ì¸)
GET  /api/render/{id}/status  # ì‘ì—… ìƒíƒœ ì¡°íšŒ
POST /api/render/{id}/cancel  # ì‘ì—… ì·¨ì†Œ
GET  /health              # í—¬ìŠ¤ì²´í¬ (GPU ìƒíƒœ í¬í•¨)
GET  /queue/status        # í ìƒíƒœ ì¡°íšŒ
```

**ì—­í• :**
- ë Œë”ë§ ìš”ì²­ ìˆ˜ì‹  ë° ê²€ì¦
- ì‘ì—…ì„ Redis íì— ì¶”ê°€
- ì›Œì»¤ í”„ë¡œì„¸ìŠ¤ ìƒëª…ì£¼ê¸° ê´€ë¦¬
- GPU ìƒíƒœ ëª¨ë‹ˆí„°ë§


### 2. ë¶„ì‚° ì‘ì—… ì²˜ë¦¬ ê³„ì¸µ

#### `celery_worker.py` - Celery ì›Œì»¤
```python
@app.task(name='render.segment')
def render_segment(job_id: str, segment: dict)
    # ë¹„ë””ì˜¤ ì„¸ê·¸ë¨¼íŠ¸ ë Œë”ë§

@app.task(name='render.merge_segments')
def merge_segments(job_id: str, segment_results: list)
    # ì„¸ê·¸ë¨¼íŠ¸ ë³‘í•©
```

**Celeryë¥¼ ì‚¬ìš©í•˜ëŠ” ì´ìœ :**
- **ë¶„ì‚° ì²˜ë¦¬**: ì—¬ëŸ¬ GPU ì¸ìŠ¤í„´ìŠ¤ì— ì‘ì—… ë¶„ì‚°
- **ì‹ ë¢°ì„±**: ì‘ì—… ì¬ì‹œë„, ì‹¤íŒ¨ ì²˜ë¦¬, ì¥ì•  ë³µêµ¬
- **í™•ì¥ì„±**: ì›Œì»¤ ìˆ˜ë¥¼ ë™ì ìœ¼ë¡œ ì¡°ì • ê°€ëŠ¥
- **ëª¨ë‹ˆí„°ë§**: ì‘ì—… ìƒíƒœ ì¶”ì  ë° ë©”íŠ¸ë¦­ ìˆ˜ì§‘

#### `render_engine.py` - GPU ë Œë”ë§ ì—”ì§„
```python
class GPURenderEngine:
    async def render_segment(self, job_id: str, segment: Dict[str, Any])
        # Phase 2 ìŠ¤íŠ¸ë¦¬ë° íŒŒì´í”„ë¼ì¸ ì‚¬ìš©
        # ë©”ëª¨ë¦¬ ìµœì í™” ì ìš©

    async def merge_segments(self, job_id: str, segment_results: list)
        # ì¸í…”ë¦¬ì „íŠ¸ ì„¸ê·¸ë¨¼íŠ¸ ë³‘í•©
```

### 3. í ë° ìƒíƒœ ê´€ë¦¬

#### `modules/queue.py` - Redis ê¸°ë°˜ ì‘ì—… í
```python
@dataclass
class RenderJob:
    job_id: str
    video_url: str
    scenario: Dict[str, Any]  # MotionText ì‹œë‚˜ë¦¬ì˜¤
    options: Dict[str, Any]   # ë Œë”ë§ ì˜µì…˜
    callback_url: str         # ë°±ì—”ë“œ ì½œë°± URL
    status: str = "queued"
    progress: int = 0
```

**Redisë¥¼ ì‚¬ìš©í•˜ëŠ” ì´ìœ :**
- **ë†’ì€ ì„±ëŠ¥**: ë©”ëª¨ë¦¬ ê¸°ë°˜ ë¹ ë¥¸ I/O
- **ë¶„ì‚° ì§€ì›**: ì—¬ëŸ¬ ì›Œì»¤ê°€ ë™ì¼í•œ íì— ì ‘ê·¼
- **ë°ì´í„° êµ¬ì¡°**: List, Hash, Set ë“± ë‹¤ì–‘í•œ ìë£Œêµ¬ì¡° ì§€ì›
- **ì˜ì†ì„±**: AOFë¥¼ í†µí•œ ë°ì´í„° ë°±ì—…

### 4. Phase 2 ìŠ¤íŠ¸ë¦¬ë° ìµœì í™”

#### `modules/streaming_pipeline.py` - ì‹¤ì‹œê°„ í”„ë ˆì„ ìŠ¤íŠ¸ë¦¬ë°
```python
class StreamingPipeline:
    # ë””ìŠ¤í¬ I/O ì—†ì´ ë©”ëª¨ë¦¬ì—ì„œ FFmpegë¡œ ì§ì ‘ ìŠ¤íŠ¸ë¦¬ë°

class AsyncFrameQueue:
    # ë°±í”„ë ˆì…” ê´€ë¦¬
    # í”„ë ˆì„ ë“œë¡­ ì •ì±…
    # ë©”ëª¨ë¦¬ í•œê³„ ëª¨ë‹ˆí„°ë§

class BackpressureManager:
    # ì‹œìŠ¤í…œ ì••ë°• ìƒí™© ê°ì§€
    # ì ì‘ì  ì²˜ë¦¬ ì†ë„ ì¡°ì ˆ
```

**Phase 2 ìµœì í™” íš¨ê³¼:**
- **ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ 70% ê°ì†Œ**: 6GB â†’ 2GB per worker
- **ë™ì‹œ ì‘ì—… ìˆ˜ 150% ì¦ê°€**: 3-4ê°œ â†’ 8-10ê°œ jobs
- **í”„ë ˆì„ ë“œë¡­ë¥  90% ê°ì†Œ**: 5-10% â†’ <1%
- **ì²˜ë¦¬ ì§€ì—° 50% ê°ì†Œ**: ë””ìŠ¤í¬ I/O ì œê±°

### 5. GPU ë Œë”ë§ ì›Œì»¤

#### `modules/worker.py` - ê¸°ë³¸ ë Œë”ë§ ì›Œì»¤ (ë ˆê±°ì‹œ)
```python
class RenderWorker:
    # Sequential ì²˜ë¦¬
    # ë‹¨ì¼ ë¸Œë¼ìš°ì € ì¸ìŠ¤í„´ìŠ¤
    # ë””ìŠ¤í¬ ê¸°ë°˜ í”„ë ˆì„ ì²˜ë¦¬
```

#### `modules/parallel_worker.py` - ë³‘ë ¬ ë Œë”ë§ ì›Œì»¤
```python
class ParallelRenderWorker:
    # ë¸Œë¼ìš°ì € í’€ ê´€ë¦¬ (ê¸°ë³¸ 4ê°œ)
    # ë™ì‹œ í”„ë ˆì„ ë Œë”ë§
    # ë¦¬ì†ŒìŠ¤ í’€ë§
```

**ë³‘ë ¬ ì²˜ë¦¬ íš¨ê³¼:**
- **ì²˜ë¦¬ëŸ‰ 3-4ë°° ì¦ê°€**
- **ë¸Œë¼ìš°ì € ì´ˆê¸°í™” ì˜¤ë²„í—¤ë“œ ê°ì†Œ**
- **ë¦¬ì†ŒìŠ¤ íš¨ìœ¨ì„± í–¥ìƒ**

### 6. í†µì‹  ë° ì½œë°±

#### `modules/callbacks.py` - ë°±ì—”ë“œ í†µì‹ 
```python
class CallbackService:
    async def send_progress()      # ì§„í–‰ë¥  ì—…ë°ì´íŠ¸
    async def send_completion()    # ì™„ë£Œ ì•Œë¦¼
    async def send_error()         # ì—ëŸ¬ ë³´ê³ 
    async def send_streaming_progress()  # Phase 2 ë©”íŠ¸ë¦­
```

**ì½œë°± ê¸°ëŠ¥:**
- **exponential backoff ì¬ì‹œë„**
- **íƒ€ì„ì•„ì›ƒ ì²˜ë¦¬**
- **Phase 2 ìŠ¤íŠ¸ë¦¬ë° ë©”íŠ¸ë¦­ ì „ì†¡**

## ğŸ”„ ë°ì´í„° í”Œë¡œìš°

### 1. ë Œë”ë§ ìš”ì²­ í”Œë¡œìš°
```
Frontend â†’ Backend API â†’ POST /render â†’ Redis Queue â†’ Celery Worker â†’ GPU Render
```

### 2. Phase 2 ìŠ¤íŠ¸ë¦¬ë° í”Œë¡œìš°
```
Playwright Browser â†’ AsyncFrameQueue â†’ StreamingPipeline â†’ FFmpeg NVENC â†’ S3 Upload
```

### 3. ì§„í–‰ë¥  ì—…ë°ì´íŠ¸ í”Œë¡œìš°
```
Celery Worker â†’ CallbackService â†’ Backend API â†’ HTTP Response â†’ Frontend
```

## ğŸš€ ì‹¤í–‰ ëª¨ë“œ ë¹„êµ

### Standalone ëª¨ë“œ (`render_server.py`)
```bash
python render_server.py --mode standalone
```

**íŠ¹ì§•:**
- FastAPI ì„œë²„ì™€ ì›Œì»¤ê°€ ë™ì¼ í”„ë¡œì„¸ìŠ¤
- ë‹¨ìˆœí•œ ë°°í¬ ë° ê´€ë¦¬
- ë‹¨ì¼ ì¸ìŠ¤í„´ìŠ¤ í™˜ê²½ì— ì í•©

**ì¥ì :**
- ì„¤ì • ë‹¨ìˆœ
- ë¡œì»¬ ê°œë°œì— ì í•©
- ë””ë²„ê¹… ìš©ì´

**ë‹¨ì :**
- ìˆ˜í‰ í™•ì¥ ì œí•œ
- ë‹¨ì¼ ì¥ì• ì 
- ë¦¬ì†ŒìŠ¤ ê²©ë¦¬ ë¶€ì¡±

### Celery ëª¨ë“œ (`celery_worker.py`)
```bash
python celery_worker.py
```

**íŠ¹ì§•:**
- ì›Œì»¤ê°€ ë…ë¦½ì ì¸ í”„ë¡œì„¸ìŠ¤/ì»¨í…Œì´ë„ˆ
- Redisë¥¼ í†µí•œ ë¶„ì‚° ì‘ì—… ê´€ë¦¬
- ë¬´ì œí•œ ìˆ˜í‰ í™•ì¥ ê°€ëŠ¥

**ì¥ì :**
- í™•ì¥ì„± ìš°ìˆ˜
- ë‚´ê²°í•¨ì„± ë†’ìŒ
- ì›Œì»¤ë³„ ë¦¬ì†ŒìŠ¤ ê²©ë¦¬
- ë¶€í•˜ ë¶„ì‚° ìë™í™”

**ë‹¨ì :**
- ì„¤ì • ë³µì¡ë„ ì¦ê°€
- Redis ì˜ì¡´ì„±
- ë„¤íŠ¸ì›Œí¬ ì˜¤ë²„í—¤ë“œ

## ğŸ§¹ ë¶ˆí•„ìš”/ë ˆê±°ì‹œ ì»´í¬ë„ŒíŠ¸

### ì œê±° ê°€ëŠ¥í•œ ì»´í¬ë„ŒíŠ¸

1. **`modules/worker.py` (ê¸°ë³¸ ì›Œì»¤)**
   - Phase 2ì—ì„œ `parallel_worker.py`ë¡œ ëŒ€ì²´ë¨
   - ì„±ëŠ¥ìƒ ì—´ë“±

2. **`modules/worker_pool.py`**
   - ì‚¬ìš©ë˜ì§€ ì•ŠëŠ” ì›Œì»¤ í’€ êµ¬í˜„
   - Celeryë¡œ ëŒ€ì²´ë¨

3. **`modules/segment_optimizer.py`**
   - ì‹¤ì œë¡œ ì‚¬ìš©ë˜ì§€ ì•ŠìŒ
   - `segment_merger.py`ë¡œ í†µí•© ê°€ëŠ¥

4. **`src/logger.py`**
   - Python í‘œì¤€ loggingìœ¼ë¡œ ì¶©ë¶„
   - ì¤‘ë³µ ê¸°ëŠ¥

### ê°œì„  ê°€ëŠ¥í•œ ë¶€ë¶„

1. **~~ì¤‘ë³µëœ ì„œë²„ ì—”íŠ¸ë¦¬í¬ì¸íŠ¸~~** âœ… ì™„ë£Œ
   - ~~`render_server.py`ì™€ `server.py` í†µí•©~~ â†’ `server.py` ì‚­ì œë¨
   - ë‹¨ì¼ ì§„ì…ì ìœ¼ë¡œ ë‹¨ìˆœí™”

2. **í™˜ê²½ ë³€ìˆ˜ ê´€ë¦¬**
   - `.env` íŒŒì¼ ë° ì„¤ì • í´ë˜ìŠ¤ë¡œ ì¤‘ì•™í™”
   - íƒ€ì… ì•ˆì „ì„± ì¶”ê°€

3. **ì—ëŸ¬ ì²˜ë¦¬ í‘œì¤€í™”**
   - ErrorCodes í´ë˜ìŠ¤ í™œìš© í™•ëŒ€
   - ì¼ê´€ëœ ì—ëŸ¬ ì‘ë‹µ í˜•ì‹

## â˜ï¸ AWS í´ë¼ìš°ë“œ ë°°í¬ ê°€ì´ë“œ

### ì¸ìŠ¤í„´ìŠ¤ íƒ€ì… ì„ íƒ

#### GPU Render Server
```yaml
ê¶Œì¥: g4dn.2xlarge
- GPU: 1x NVIDIA T4 (16GB VRAM)
- CPU: 8 vCPUs
- Memory: 32GB
- ë„¤íŠ¸ì›Œí¬: ìµœëŒ€ 25 Gbps
- ì‹œê°„ë‹¹ ë¹„ìš©: ~$1.26

Phase 2 ìµœì í™”ë¡œ ë” ì‘ì€ ì¸ìŠ¤í„´ìŠ¤ë„ ê°€ëŠ¥:
ëŒ€ì•ˆ: g4dn.xlarge
- Memory: 16GB (2GB/worker Ã— 8 workers)
- ì‹œê°„ë‹¹ ë¹„ìš©: ~$0.63
```

#### ML Audio Server
```yaml
ê¶Œì¥: g4dn.xlarge
- GPU: 1x NVIDIA T4 (16GB VRAM)
- CPU: 4 vCPUs
- Memory: 16GB
- ìŒì„± ì¸ì‹ ë° í™”ì ë¶„ë¦¬ì— ì¶©ë¶„
```

### ë°°í¬ ì˜µì…˜ ë¹„êµ

#### Option 1: ECS on EC2 (ê¶Œì¥)
```yaml
ì¥ì :
- GPU ì§€ì› ì™„ë²½
- Docker ì»¨í…Œì´ë„ˆ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜
- Auto Scaling ì§€ì›
- ì„œë¹„ìŠ¤ ë””ìŠ¤ì»¤ë²„ë¦¬

ë‹¨ì :
- ì„¤ì • ë³µì¡
- ì¸í”„ë¼ ê´€ë¦¬ í•„ìš”
```

#### Option 2: ë‹¨ìˆœ EC2 ì¸ìŠ¤í„´ìŠ¤
```yaml
ì¥ì :
- ì„¤ì • ë‹¨ìˆœ
- ì§ì ‘ì ì¸ GPU ì ‘ê·¼
- ìµœëŒ€ ì„±ëŠ¥

ë‹¨ì :
- ìˆ˜ë™ ê´€ë¦¬ í•„ìš”
- í™•ì¥ì„± ì œí•œ
- ëª¨ë‹ˆí„°ë§ ë¶€ì¡±
```

#### Option 3: ECS Fargate
```yaml
í˜„ì¬ ë¶ˆê°€ëŠ¥:
- FargateëŠ” GPU ì§€ì› ì•ˆ í•¨
- GPU ì›Œí¬ë¡œë“œì— ë¶€ì í•©
```

### ë¹„ìš© ìµœì í™” ì „ëµ

#### 1. Spot Instance í™œìš©
```bash
# ìµœëŒ€ 70% ë¹„ìš© ì ˆê°
aws ec2 request-spot-instances \
  --instance-count 2 \
  --type "one-time" \
  --spot-price "0.5" \
  --launch-specification '{
    "ImageId": "ami-12345678",
    "InstanceType": "g4dn.2xlarge",
    "SecurityGroupIds": ["sg-12345678"]
  }'
```

#### 2. Auto Scaling ì •ì±…
```yaml
Time-based Scaling:
  Peak Hours (09:00-18:00 KST):
    Min: 4 workers
    Max: 12 workers

  Off-peak:
    Min: 2 workers
    Max: 6 workers

Metric-based Scaling:
  Scale Out: Queue Depth > 10 jobs
  Scale In: Queue Depth < 3 jobs for 10 minutes
```

#### 3. Reserved Instance
```yaml
1ë…„ ì˜ˆì•½ ì‹œ í• ì¸ìœ¨:
- g4dn.2xlarge: 31% í• ì¸
- g4dn.xlarge: 30% í• ì¸

3ë…„ ì˜ˆì•½ ì‹œ í• ì¸ìœ¨:
- g4dn.2xlarge: 52% í• ì¸
- g4dn.xlarge: 50% í• ì¸
```

### ë°°í¬ ì•„í‚¤í…ì²˜ ì˜ˆì‹œ

#### Production í™˜ê²½
```yaml
ALB (Application Load Balancer)
â””â”€â”€ ECS Service: gpu-render-api
    â”œâ”€â”€ Task: render-server (Fargate)
    â””â”€â”€ Task: celery-worker (EC2 with GPU)
        â”œâ”€â”€ Instance: g4dn.2xlarge Ã— 2-8 (Auto Scaling)
        â””â”€â”€ ElastiCache Redis Cluster
```

#### Development í™˜ê²½
```yaml
ë‹¨ì¼ EC2 Instance: g4dn.xlarge
â”œâ”€â”€ Docker Compose
â”œâ”€â”€ Redis Container
â””â”€â”€ GPU Render Container
```

### ë„¤íŠ¸ì›Œí¬ ì„¤ì •

#### VPC êµ¬ì„±
```yaml
VPC CIDR: 10.0.0.0/16

Subnets:
  Public: 10.0.1.0/24  # ALB
  Private: 10.0.2.0/24 # ECS Tasks
  GPU: 10.0.3.0/24     # GPU Instances

Security Groups:
  ALB-SG: 443 from 0.0.0.0/0
  API-SG: 8090 from ALB-SG
  GPU-SG: 6379 from API-SG (Redis)
```

#### í•„ìˆ˜ í¬íŠ¸
```yaml
8090: GPU Render Server API
6379: Redis
443: HTTPS (ALB)
80: HTTP Redirect
```

### ëª¨ë‹ˆí„°ë§ ì„¤ì •

#### CloudWatch ë©”íŠ¸ë¦­
```python
# Custom Metrics
cloudwatch.put_metric_data(
    Namespace='ECG/Render',
    MetricData=[
        {
            'MetricName': 'QueueDepth',
            'Value': queue_size,
            'Unit': 'Count'
        },
        {
            'MetricName': 'FrameDropRate',
            'Value': drop_rate,
            'Unit': 'Percent'
        }
    ]
)
```

#### ì•ŒëŒ ì„¤ì •
```yaml
Critical Alarms:
- GPU Memory > 90%
- Queue Depth > 50 jobs
- Frame Drop Rate > 5%
- Worker Health Check Failed

Warning Alarms:
- CPU > 80% for 5 minutes
- Memory > 85%
- Response Time > 3 seconds
```

## ğŸ“Š ì„±ëŠ¥ ë²¤ì¹˜ë§ˆí¬

### Phase 1 vs Phase 2 ë¹„êµ

| ë©”íŠ¸ë¦­ | Phase 1 | Phase 2 | ê°œì„ ìœ¨ |
|--------|---------|---------|--------|
| ë©”ëª¨ë¦¬/ì›Œì»¤ | 6GB | 2GB | -70% |
| ë™ì‹œ ì‘ì—… | 3-4ê°œ | 8-10ê°œ | +150% |
| í”„ë ˆì„ ë“œë¡­ë¥  | 5-10% | <1% | -90% |
| ì²˜ë¦¬ ì§€ì—° | ë†’ìŒ | ë‚®ìŒ | -50% |

### ë¹„ìš© íš¨ìœ¨ì„± (AWS)

| êµ¬ì„± | Phase 1 | Phase 2 | ì ˆì•½ |
|------|---------|---------|------|
| ì¸ìŠ¤í„´ìŠ¤ íƒ€ì… | g4dn.4xlarge Ã— 3 | g4dn.2xlarge Ã— 4 | - |
| ì‹œê°„ë‹¹ ë¹„ìš© | $7.56 | $5.04 | 33% |
| ë™ì‹œ ì²˜ë¦¬ | 9-12 jobs | 32-40 jobs | 250% |
| ë¹„ìš©/job | $0.63 | $0.13 | 79% |

## ğŸ”§ ë¡œì»¬ ê°œë°œ í™˜ê²½ ì„¤ì •

### Docker Compose ê°œë°œ
```bash
# GPU ì§€ì› Docker Compose
docker-compose up -d

# ë¡œê·¸ í™•ì¸
docker-compose logs -f gpu-render

# ìŠ¤ì¼€ì¼ ì¡°ì •
docker-compose up --scale gpu-render=3
```

### ë¡œì»¬ í™˜ê²½ ë³€ìˆ˜
```bash
# .env íŒŒì¼
REDIS_URL=redis://localhost:6379
S3_BUCKET=ecg-videos-dev
AWS_PROFILE=dev
MAX_CONCURRENT_JOBS=2
USE_PARALLEL_RENDERING=true
BROWSER_POOL_SIZE=2
```

### ê°œë°œ ì„œë²„ ì‹¤í–‰
```bash
# Standalone ëª¨ë“œ
python render_server.py --mode standalone --log-level debug

# Celery ëª¨ë“œ
redis-server &
python celery_worker.py &
python render_server.py --mode celery
```

## ğŸš¨ ë¬¸ì œ í•´ê²° ê°€ì´ë“œ

### ì¼ë°˜ì ì¸ ë¬¸ì œë“¤

#### 1. GPU ë©”ëª¨ë¦¬ ë¶€ì¡±
```bash
# ì¦ìƒ: CUDA out of memory
# í•´ê²°: MAX_CONCURRENT_JOBS ê°ì†Œ
export MAX_CONCURRENT_JOBS=2

# ë˜ëŠ” ë” í° ì¸ìŠ¤í„´ìŠ¤ ì‚¬ìš©
# g4dn.xlarge â†’ g4dn.2xlarge
```

#### 2. Redis ì—°ê²° ì‹¤íŒ¨
```bash
# í™•ì¸
redis-cli ping

# ì¬ì‹œì‘
sudo systemctl restart redis

# ì„¤ì • í™•ì¸
echo $REDIS_URL
```

#### 3. FFmpeg GPU ì¸ì½”ë”© ì‹¤íŒ¨
```bash
# NVENC ì§€ì› í™•ì¸
ffmpeg -encoders | grep nvenc

# ë“œë¼ì´ë²„ í™•ì¸
nvidia-smi

# CUDA ì„¤ì¹˜ í™•ì¸
nvcc --version
```

#### 4. Phase 2 ë†’ì€ í”„ë ˆì„ ë“œë¡­ë¥ 
```python
# ë°±í”„ë ˆì…” ì„¤ì • ì¡°ì •
MEMORY_THRESHOLD_MB=300  # ê¸°ë³¸ 500ì—ì„œ ê°ì†Œ
QUEUE_MAX_SIZE=30        # ê¸°ë³¸ 60ì—ì„œ ê°ì†Œ
```

### ë¡œê·¸ ë¶„ì„

#### ì¤‘ìš”í•œ ë¡œê·¸ íŒ¨í„´
```bash
# ì„±ê³µì ì¸ ë Œë”ë§
"âœ… Pipeline stats: {'dropped_frames': 12, 'processed_frames': 1800, 'drop_rate': 0.0067}"

# ë©”ëª¨ë¦¬ ì••ë°•
"âš ï¸ Memory limit exceeded. Dropping frame 1234"

# GPU ì¸ì½”ë”© ë¬¸ì œ
"âŒ FFmpeg error: Cannot load nvenc encoder"

# Redis ì—°ê²° ë¬¸ì œ
"âŒ Redis connection failed: Connection refused"
```

## ğŸ“ˆ í™•ì¥ì„± ê³ ë ¤ì‚¬í•­

### ìˆ˜í‰ í™•ì¥
- **GPU ì›Œì»¤**: ìµœëŒ€ 20ê°œ ì¸ìŠ¤í„´ìŠ¤ê¹Œì§€ í™•ì¥ ê°€ëŠ¥
- **ì²˜ë¦¬ ìš©ëŸ‰**: ì‹œê°„ë‹¹ 1,000+ ë¹„ë””ì˜¤ ë Œë”ë§
- **ë™ì‹œ ì‚¬ìš©ì**: 10,000+ ë™ì‹œ ì ‘ì† ì§€ì›

### ê¸€ë¡œë²Œ í™•ì¥
- **ë©€í‹° ë¦¬ì „**: ê° ëŒ€ë¥™ë³„ ë¦¬ì „ ë°°í¬
- **CDN**: CloudFrontë¡œ ë Œë”ë§ ê²°ê³¼ ì „ì†¡ ìµœì í™”
- **ë°ì´í„° ë³µì œ**: ë¦¬ì „ ê°„ S3 ë³µì œ

---

ì´ ë¬¸ì„œëŠ” ECG GPU Render Serverì˜ ì™„ì „í•œ ì´í•´ì™€ íš¨ê³¼ì ì¸ í´ë¼ìš°ë“œ ë°°í¬ë¥¼ ìœ„í•œ ëª¨ë“  ì •ë³´ë¥¼ ì œê³µí•©ë‹ˆë‹¤. Phase 2 ìŠ¤íŠ¸ë¦¬ë° ìµœì í™”ë¥¼ í†µí•´ ë” ì ì€ ë¹„ìš©ìœ¼ë¡œ ë” ë†’ì€ ì„±ëŠ¥ì„ ë‹¬ì„±í•  ìˆ˜ ìˆìœ¼ë©°, Celery + Redis ì¡°í•©ìœ¼ë¡œ í™•ì¥ì„±ê³¼ ì•ˆì •ì„±ì„ ë™ì‹œì— í™•ë³´í–ˆìŠµë‹ˆë‹¤.